<div class="wasm-demo-container">
  <header class="demo-header">
    <h1>WebAssembly + Angular Demo</h1>
    <p>Interactive demonstration of WebAssembly integration with Angular</p>
  </header>

  <!-- WASM Loading Status -->
  <div class="status-card" [ngClass]="{'loading': loadingWasm, 'loaded': isWasmLoaded, 'error': !isWasmLoaded && !loadingWasm}">
    <h3>üîß WebAssembly Status</h3>
    <div class="status-indicator">
      @if (loadingWasm) {
        <span class="loading-spinner">‚è≥</span>
      }
      @if (isWasmLoaded && !loadingWasm) {
        <span class="success">‚úÖ Loaded</span>
      }
      @if (!isWasmLoaded && !loadingWasm) {
        <span class="error">‚ùå Not Loaded</span>
      }
    </div>
    @if (isWasmLoaded) {
      <div class="wasm-type">
        <small>
          Using: <strong>{{ wasmService.isUsingRealWasm() ? 'Real WebAssembly' : 'JavaScript Fallback' }}</strong>
        </small>
      </div>
    }
    @if (!isWasmLoaded && !loadingWasm) {
      <button (click)="loadWasm()" class="reload-btn">
        üîÑ Reload WASM
      </button>
    }
  </div>

  <!-- Mathematical Operations -->
  <div class="operations-grid">
    
    <!-- Addition -->
    <div class="operation-card">
      <h3>‚ûï Addition</h3>
      <div class="input-group">
        <label>First Number:</label>
        <input type="number" [(ngModel)]="addA" class="number-input">
      </div>
      <div class="input-group">
        <label>Second Number:</label>
        <input type="number" [(ngModel)]="addB" class="number-input">
      </div>
      <button (click)="performAdd()" [disabled]="!isWasmLoaded" class="calculate-btn">
        Calculate {{ addA }} + {{ addB }}
      </button>
    </div>

    <!-- Multiplication -->
    <div class="operation-card">
      <h3>‚úñÔ∏è Multiplication</h3>
      <div class="input-group">
        <label>First Number:</label>
        <input type="number" [(ngModel)]="multiplyA" class="number-input">
      </div>
      <div class="input-group">
        <label>Second Number:</label>
        <input type="number" [(ngModel)]="multiplyB" class="number-input">
      </div>
      <button (click)="performMultiply()" [disabled]="!isWasmLoaded" class="calculate-btn">
        Calculate {{ multiplyA }} √ó {{ multiplyB }}
      </button>
    </div>

    <!-- Factorial -->
    <div class="operation-card">
      <h3>üî¢ Factorial</h3>
      <div class="input-group">
        <label>Number (n!):</label>
        <input type="number" [(ngModel)]="factorialN" min="0" max="20" class="number-input">
      </div>
      <button (click)="performFactorial()" [disabled]="!isWasmLoaded" class="calculate-btn">
        Calculate {{ factorialN }}!
      </button>
      <small class="note">*Limited to n ‚â§ 20 for demo purposes</small>
    </div>

  </div>

  <!-- Performance Test -->
  <div class="performance-section">
    <h3>‚ö° Performance Comparison</h3>
    <p>Compare JavaScript vs WebAssembly execution speed</p>
    
    <button (click)="runPerformanceTest()" 
            [disabled]="!isWasmLoaded || runningPerformanceTest" 
            class="performance-btn">
      @if (!runningPerformanceTest) {
        <span>üèÉ‚Äç‚ôÇÔ∏è Run Performance Test</span>
      }
      @if (runningPerformanceTest) {
        <span>‚è≥ Running...</span>
      }
    </button>

    @if (performanceResults) {
      <div class="performance-results">
        <div class="performance-metric">
          <span class="label">JavaScript Time:</span>
          <span class="value">{{ performanceResults.jsTime }}ms</span>
        </div>
        <div class="performance-metric">
          <span class="label">WebAssembly Time:</span>
          <span class="value">{{ performanceResults.wasmTime }}ms</span>
        </div>
        <div class="performance-metric highlight">
          <span class="label">Speed Improvement:</span>
          <span class="value">{{ performanceResults.speedup }}x</span>
        </div>
      </div>
    }
  </div>

  <!-- Results Display -->
  <div class="results-section">
    <div class="results-header">
      <h3>üìä Calculation Results</h3>
      <button (click)="clearResults()" class="clear-btn" [disabled]="results.length === 0">
        üóëÔ∏è Clear
      </button>
    </div>

    @if (results.length === 0) {
      <div class="no-results">
        No calculations performed yet. Try the operations above!
      </div>
    }

    @if (results.length > 0) {
      <div class="results-table">
        <div class="table-header">
          <div class="col-operation">Operation</div>
          <div class="col-input">Input</div>
          <div class="col-result">Result</div>
          <div class="col-time">Time (ms)</div>
          <div class="col-timestamp">Timestamp</div>
        </div>

        @for (result of results; track result.timestamp) {
          <div class="table-row" 
               [ngClass]="{'system-result': result.operation === 'System'}">
            <div class="col-operation">{{ result.operation }}</div>
            <div class="col-input">{{ result.input }}</div>
            <div class="col-result">{{ result.result }}</div>
            <div class="col-time">{{ result.executionTime }}</div>
            <div class="col-timestamp">{{ result.timestamp | date:'HH:mm:ss' }}</div>
          </div>
        }
      </div>
    }
  </div>

</div>
